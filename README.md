# Сбор и анализ логов


## Задачи:

1. В вагранте поднимаем 2 машины web и log
* на web поднимаем nginx
* на log настраиваем центральный лог сервер на любой системе на выбор
- journald
- __rsyslog__
- elk
* настраиваем аудит следящий за изменением конфигов нжинкса

* все критичные логи с web должны собираться и локально и удаленно
* все логи с nginx должны уходить на удаленный сервер (локально только критичные)
* логи аудита должны также уходить на удаленную систему

2. развернуть еще машину elk
и таким образом настроить 2 центральных лог системы elk И какую либо еще
* в elk должны уходить только логи нжинкса
* во вторую систему все остальное

## Реализация.

Описанный выше стенд разворачиваетс посредством Vagrantfile, в котором описаны характеристики виртуальных хостов, с учетом требовательности стека elk к ресурсам.
Минимальный общий провижионинг обеспечивается также посредством Vagrantfile:
* Установка временной зоны
* Настройка sshd
* Отключение firewalld
* Отключение SELinux

Далее провижионинг происходит посредством ansible-role.


##Хосты:

* __web__: поднят nginx, все логи отравляются согласно поставленной задаче на хост __logger__
* __logger__: накапливает все, пришедшие логи с хоста __web__ и отправляет логи nginx посредством filebeat на хост __elk__
* __elk__: поднят стек elasticsearch-logstash-kibana, logstash принимает пришедшие логи nginx с __logger__, парсит их, складывает в elasticsearch и далее их можно читать в kibana


Результат можно увидеть на скриншотах:

![crtindex_01.png](https://github.com/zradeg/otus_hw16/blob/master/screen/crtindex_01.png)
![crtindex_02.png](https://github.com/zradeg/otus_hw16/blob/master/screen/crtindex_02.png)
![crtindex_03.png](https://github.com/zradeg/otus_hw16/blob/master/screen/crtindex_03.png)
